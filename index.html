<!DOCTYPE html>
<html>
	<head>
		<title>SurveyMonkey</title>
	</head>
	<body style ="background-color:powderblue;">
		<div>
			<label>What is your email?</label>
			<input type='text' name='email'>
		</div>
		<div>
			<label>What is your age?</label>
			<input type='text' name='age'>
		</div>
		<div>
			<label>What is your name?</label>
			<input type='text' name='name'>
		</div>
		<div>
			<label>What is your username?<label>
			<input type='text' name='username'>
		</div>
		<div>
			<label>What are your hobbies/interests?</label>
			<input type='text' name='hobby'>
		</div>
		<div>
			<label>What is your phone number?</label>
			<input type='text' name='phone'>
		</div>
		<div>
			<label>What is your password? </label>
			<input type='password' name='password'>
		</div>
		<div>
			<label>Verify Password </label>
			<input type='password' name='verify'>
		</div>
		<div>
			<button>Submit</button>
		</div>
		<script>
		var $inputs = document.querySelectorAll('input')
		var $button = document.querySelector('button')
		function storeData() {
			var data = {};
			for(var i=0; i < $inputs.length; i++){
				var $input = $inputs[i];
				data[$input.name]  = $input.value;
			}
			verifyPassword();
			sendData(data);
		}
		function verifyPassword() {
			var $passwords = document.querySelectorAll('input[type="password"]');
			var $samePasswords = $passwords[0].value === $passwords[1].value
			if(!$samePasswords) return alert('Passwords not matching')
			return true
		}

		function sendData(data) {
			// Creating a new request to the server that contains the data
			var req = new XMLHttpRequest();

			// Opening up a connection with the server to 'POST' data
				req.open('POST', '/surveymonkey', true);

			// Explain to the server that we are sending the data in json format
				req.setRequestHeader('content-type', 'application/json')
				// Alert the user to any errors from the server
				function readyStateChange() {
					if(req.readyState !== 4) return;
					if(req.status !== 200) return;
					data = JSON.parse(req.responseText);
					if(data.error) {
						alert(data.error);
					}
				}				
req.onreadystatechange = readyStateChange;

			// Sending the data in JSON format
				req.send(JSON.stringify(data));
			}

		$button.addEventListener('click', storeData);
		</script>
	</body>
</html>
